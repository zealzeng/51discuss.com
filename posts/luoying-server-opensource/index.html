<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>武汉珞樱联创Luoying-server和Fabric-REST开源 | 谈前沿技术</title>
    <meta property="og:title" content="武汉珞樱联创Luoying-server和Fabric-REST开源 - 谈前沿技术">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2018-12-16T22:31:02&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2018-12-16T22:31:02&#43;08:00'>
        
    <meta name="Keywords" content="java,区块链,人工智能,物联网,操作系统,面试,问答,项目指导">
    <meta name="description" content="武汉珞樱联创Luoying-server和Fabric-REST开源">
        
    <meta name="author" content="Zealot">
    <meta property="og:url" content="https://www.51discuss.com/posts/luoying-server-opensource/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://www.51discuss.com/">
                        谈前沿技术
                    </a>
                
                <p class="description">www.51discuss.com,耕云不尽,钓月无痕。</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://www.51discuss.com/">首页</a>
                    
                    <a  href="https://www.51discuss.com/archives/" title="归档">归档</a>
                    
                    <a  href="https://www.51discuss.com/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#武汉珞樱联创luoying-server和fabric-rest开源">武汉珞樱联创Luoying-server和Fabric-REST开源</a>
      <ul>
        <li><a href="#http服务器">HTTP服务器</a></li>
        <li><a href="#socket服务器">Socket服务器</a></li>
        <li><a href="#application-profile模板">Application Profile模板</a></li>
        <li><a href="#api文档">API文档</a></li>
        <li><a href="#开发计划">开发计划</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if (leftPos < 220) {
                postToc.css({ "width": leftPos - 10, "margin-left": (0 - leftPos) })
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }

        if ($("#TableOfContents").children().length < 1) {
            $(".post-toc").remove();
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">武汉珞樱联创Luoying-server和Fabric-REST开源</h1>
        </header>
        <date class="post-meta meta-date">
            2018年12月16日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80'>编程语言</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="clear" style="display: none">
            <div class="toc-article">
                <div class="toc-title">文章目录</div>
            </div>
        </div>
        
        <div class="post-content">
            <h2 id="武汉珞樱联创luoying-server和fabric-rest开源">武汉珞樱联创Luoying-server和Fabric-REST开源</h2>
<p><a href="https://github.com/zealzeng/luoying-server">https://github.com/zealzeng/luoying-server</a>
<a href="https://github.com/zealzeng/fabric-rest">https://github.com/zealzeng/fabric-rest</a>
Luoying Server Framework</p>
<p>Luoying server是一个轻量级的服务器开发框架，方便开发者快速的定制多种协议的服务器，servlet style的API和简单的容器注入模式让开发者专注于业务实现。
Maven地址</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;groupId&gt;</span>com.whlylc<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;artifactId&gt;</span>luoying-server<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;version&gt;</span>0.1.0<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id="http服务器">HTTP服务器</h3>
<ul>
<li>HttpRequest和HttpResponse与Servlet API接近</li>
<li>ConcurrentApplicationContext是简单的BeanFactory实现, 方便注入所需组件</li>
</ul>
<p>参考TestHttpServer.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        HttpService service <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HttpService<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">service</span><span style="color:#f92672">(</span>HttpRequest request<span style="color:#f92672">,</span> HttpResponse response<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                response<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">valueOf</span><span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">()));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//If we need business beans, inject here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ConcurrentApplicationContext appCtx <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConcurrentApplicationContext<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        appCtx<span style="color:#f92672">.</span><span style="color:#a6e22e">addBean</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;mybatis&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;mybatisService&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        service<span style="color:#f92672">.</span><span style="color:#a6e22e">setApplicationContext</span><span style="color:#f92672">(</span>appCtx<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        DefaultHttpServer server <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DefaultHttpServer<span style="color:#f92672">(</span>8080<span style="color:#f92672">,</span> service<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        server<span style="color:#f92672">.</span><span style="color:#a6e22e">startup</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="socket服务器">Socket服务器</h3>
<ul>
<li>socket通信协议简单使用Netty的LengthFieldBasedFrameDecoder，即长度+消息体
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  SockService service <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SockService<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">service</span><span style="color:#f92672">(</span>SockRequest request<span style="color:#f92672">,</span> SockResponse response<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>          System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestBody</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>          response<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">valueOf</span><span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">()));</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//Attach application if it&#39;s necessary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  ConcurrentApplicationContext ctx <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConcurrentApplicationContext<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>  ctx<span style="color:#f92672">.</span><span style="color:#a6e22e">addBean</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;mybatis&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;mybatisService&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>  service<span style="color:#f92672">.</span><span style="color:#a6e22e">setApplicationContext</span><span style="color:#f92672">(</span>ctx<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DefaultSockServer server <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DefaultSockServer<span style="color:#f92672">(</span>9090<span style="color:#f92672">,</span> service<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>server<span style="color:#f92672">.</span><span style="color:#a6e22e">startup</span><span style="color:#f92672">();</span>
</span></span></code></pre></div></li>
</ul>
<p>}</p>
<pre tabindex="0"><code>-   多端口服务器
```java
    public static void main(String[] args) throws Exception {

        HttpService httpService = new HttpService() {
            @Override
            public void service(HttpRequest request, HttpResponse response) throws Exception {
                response.write(String.valueOf(System.currentTimeMillis()));
            }
        };
        SockService sockService = new SockService() {
            @Override
            public void service(SockRequest request, SockResponse response) throws Exception {
                System.out.println(request.getRequestBody().toString());
                response.write(String.valueOf(System.currentTimeMillis()));
            }
        };

        //Attach application if it&#39;s necessary
        ConcurrentApplicationContext ctx = new ConcurrentApplicationContext();
        ctx.addBean(&#34;mybatis&#34;, new String(&#34;mybatisService&#34;));
        sockService.setApplicationContext(ctx);
        httpService.setApplicationContext(ctx);

        DefaultHttpChannelService httpChannelService = new DefaultHttpChannelService(8080, httpService);
        DefaultSockChannelService sockChannelService = new DefaultSockChannelService(9090, sockService);
        ChannelService[] services = new ChannelService[] {httpChannelService, sockChannelService};
        MultiChannelServer server = new MultiChannelServer(services);
        server.startup();

    }
    ```

### 开发计划
想实现的东西不少,当前版本结合Fabric Rest稍稳定后规划。


## Luoying Fabric REST

Hyperledger Fabric是当前商用度最高的联盟区块链平台,客户端SDK正式release的有Node.js和Java版本, 非正式发布的SDK有Python, Go和REST. 对于其它开发语言而言原本可以使用REST,只可惜REST一年未更新了。Fabric的更新速度远远超前于SDK. 而Luoying-fabric-rest是类似原REST做法基于Java SDK做包装或代理, 方便其它开发语言通过http协议接入fabric节点和通道, 注册用户,调用链码查询和更新等等，尽量简化接入fabric网络的操作。
Maven地址
```xml
&lt;dependency&gt;
  &lt;groupId&gt;com.whlylc&lt;/groupId&gt;
  &lt;artifactId&gt;fabric-rest&lt;/artifactId&gt;
  &lt;version&gt;1.2.0-rc1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><h3 id="application-profile模板">Application Profile模板</h3>
<p>参考/doc/app-profile.json</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;ca&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;ca.example.com&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;location&#34;</span>: <span style="color:#e6db74">&#34;http://192.168.31.168:7054&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;admin&#34;</span>: <span style="color:#e6db74">&#34;admin&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;password&#34;</span>: <span style="color:#e6db74">&#34;adminpw&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;users&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;user001&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;orgName&#34;</span>: <span style="color:#e6db74">&#34;org1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;affiliation&#34;</span>:<span style="color:#e6db74">&#34;org1.deparment001&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;orderers&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;orderer.example.com&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;location&#34;</span>: <span style="color:#e6db74">&#34;grpc://192.168.31.168:7050&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;peers&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;peer0.org1.example.com&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;orgName&#34;</span>: <span style="color:#e6db74">&#34;org1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;location&#34;</span>: <span style="color:#e6db74">&#34;grpc://192.168.31.168:7051&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;eventHub&#34;</span>: <span style="color:#e6db74">&#34;grpc://192.168.31.168:7053&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;orgs&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;orgName&#34;</span>: <span style="color:#e6db74">&#34;org1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;orgMspId&#34;</span>: <span style="color:#e6db74">&#34;Org1MSP&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;orgDomainName&#34;</span>: <span style="color:#e6db74">&#34;org1.example.com&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;caName&#34;</span>: <span style="color:#e6db74">&#34;ca.example.com&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;channels&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;mychannel&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;peers&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;peer0.org1.example.com&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;orderers&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;orderer.example.com&#34;</span>
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="api文档">API文档</h3>
<p>参考/doc/fabric-rest-api.docx
Fabric测试网络</p>
<p>参考/fabcar,官方hyperldger fabric 1.2中fabric-sample自带例子, 稍做调整
测试用例</p>
<p>参考FabricRestTest.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.whlylc.fabricrest<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.alibaba.fastjson.JSONArray<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.alibaba.fastjson.JSONObject<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.whlylc.fabricrest.util.FileUtils<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.whlylc.fabricrest.util.HttpUtils<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.whlylc.fabricrest.vo.FabricUser<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.whlylc.fabricrest.vo.Result<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hyperledger.fabric.sdk.security.CryptoSuite<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hyperledger.fabric_ca.sdk.HFCAAffiliation<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hyperledger.fabric_ca.sdk.HFCAClient<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.File<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Created by Zeal on 2018/10/7 0007.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FabricRestTest</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String appId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;app1&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String appSecret <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1234567890&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String uri <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://localhost:8080&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testAppProfile</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        String url <span style="color:#f92672">=</span> uri <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/appProfile?appId=&#34;</span> <span style="color:#f92672">+</span> appId <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;appSecret=&#34;</span> <span style="color:#f92672">+</span> appSecret<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        File dir <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">getProperty</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user.dir&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        File jsonFile <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>dir<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;doc/app-profile.json&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        String json <span style="color:#f92672">=</span> FileUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">readFileToString</span><span style="color:#f92672">(</span>jsonFile<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        Result<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> result <span style="color:#f92672">=</span> HttpUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">post</span><span style="color:#f92672">(</span>url<span style="color:#f92672">,</span> json<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>result<span style="color:#f92672">.</span><span style="color:#a6e22e">getResultEntity</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        File targetFile <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>dir<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;doc/app-profile-target.json&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        FileUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>targetFile<span style="color:#f92672">,</span> result<span style="color:#f92672">.</span><span style="color:#a6e22e">getResultEntity</span><span style="color:#f92672">(),</span> <span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testListAffiliation</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//Fabric CA URL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        HFCAClient caClient <span style="color:#f92672">=</span> HFCAClient<span style="color:#f92672">.</span><span style="color:#a6e22e">createNewInstance</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;http://192.168.31.168:7054&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        caClient<span style="color:#f92672">.</span><span style="color:#a6e22e">setCryptoSuite</span><span style="color:#f92672">(</span>CryptoSuite<span style="color:#f92672">.</span><span style="color:#a6e22e">Factory</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getCryptoSuite</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        FabricUser user <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FabricUser<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//TODO Copy the ca private key and signed cert here to query all affiliations
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        user<span style="color:#f92672">.</span><span style="color:#a6e22e">setPrivateKey</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-----BEGIN EC PRIVATE KEY-----\r\nMHcCAQEEIEzAclLGEdj27lO/xAxo951L1/KEcrFUQst9UfyHavZOoAoGCCqGSM49\r\nAwEHoUQDQgAEmdlbG3KArAVGEBDLshNLJs32gVdqdvwVV2WSF0aLC3kiz8LUVHsV\r\nxWSSw3oJDlW//b/51dyl/vnbu6EymT/uOw==\r\n-----END EC PRIVATE KEY-----\r\n&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        user<span style="color:#f92672">.</span><span style="color:#a6e22e">setSignedCert</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-----BEGIN CERTIFICATE-----\nMIICAjCCAaigAwIBAgIUdBr3IbIZ+lXJusXNmyvgE7f4WU8wCgYIKoZIzj0EAwIw\nczELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNh\nbiBGcmFuY2lzY28xGTAXBgNVBAoTEG9yZzEuZXhhbXBsZS5jb20xHDAaBgNVBAMT\nE2NhLm9yZzEuZXhhbXBsZS5jb20wHhcNMTgxMjE1MDczMTAwWhcNMTkxMjE1MDcz\nNjAwWjAhMQ8wDQYDVQQLEwZjbGllbnQxDjAMBgNVBAMTBWFkbWluMFkwEwYHKoZI\nzj0CAQYIKoZIzj0DAQcDQgAEmdlbG3KArAVGEBDLshNLJs32gVdqdvwVV2WSF0aL\nC3kiz8LUVHsVxWSSw3oJDlW//b/51dyl/vnbu6EymT/uO6NsMGowDgYDVR0PAQH/\nBAQDAgeAMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFMXIi7kIFecYeM6EHzBYDILl\n31EfMCsGA1UdIwQkMCKAIEI5qg3NdtruuLoM2nAYUdFFBNMarRst3dusalc2Xkl8\nMAoGCCqGSM49BAMCA0gAMEUCIQDRBUqTiJTiECNe9hEdCChLlfMBThi6K1hS9JGr\nIMsIpAIgZCbdXmW0uEQxjcjytCAYlm9hb7Wzm+ArRFmKAnSOAfs=\n-----END CERTIFICATE-----\n&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        HFCAAffiliation resp <span style="color:#f92672">=</span> caClient<span style="color:#f92672">.</span><span style="color:#a6e22e">getHFCAAffiliations</span><span style="color:#f92672">(</span>user<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>HFCAAffiliation aff <span style="color:#f92672">:</span> resp<span style="color:#f92672">.</span><span style="color:#a6e22e">getChildren</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>aff<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;==&gt;&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>HFCAAffiliation c <span style="color:#f92672">:</span> aff<span style="color:#f92672">.</span><span style="color:#a6e22e">getChildren</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>c<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testInitLedger</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        JSONObject object <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JSONObject<span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;channel&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;mychannel&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;version&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;1.0&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;chaincode&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;fabcar&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;function&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;initLedger&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;user001&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;organization&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;org1&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        String url <span style="color:#f92672">=</span> uri <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/queryByChaincode?appId=&#34;</span> <span style="color:#f92672">+</span> appId <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;appSecret=&#34;</span> <span style="color:#f92672">+</span> appSecret<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        String requestBody <span style="color:#f92672">=</span> object<span style="color:#f92672">.</span><span style="color:#a6e22e">toJSONString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        Result<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> httpResult <span style="color:#f92672">=</span> HttpUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">post</span><span style="color:#f92672">(</span>url<span style="color:#f92672">,</span> requestBody<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>httpResult<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">queryAllCars</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        JSONObject object <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JSONObject<span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;channel&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;mychannel&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;version&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;1.0&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;chaincode&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;fabcar&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;function&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;queryAllCars&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;user001&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;organization&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;org1&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        String url <span style="color:#f92672">=</span> uri <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/queryByChaincode?appId=&#34;</span> <span style="color:#f92672">+</span> appId <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;appSecret=&#34;</span> <span style="color:#f92672">+</span> appSecret<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        String requestBody <span style="color:#f92672">=</span> object<span style="color:#f92672">.</span><span style="color:#a6e22e">toJSONString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        Result<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> httpResult <span style="color:#f92672">=</span> HttpUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">post</span><span style="color:#f92672">(</span>url<span style="color:#f92672">,</span> requestBody<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>httpResult<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createCar</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        JSONObject object <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JSONObject<span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;channel&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;mychannel&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;version&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;1.0&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;chaincode&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;fabcar&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;function&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;createCar&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        JSONArray array <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JSONArray<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//var car = Car{Make: args[1], Model: args[2], Colour: args[3], Owner: args[4]}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">//Car{Make: &#34;Ford&#34;, Model: &#34;Mustang&#34;, Colour: &#34;red&#34;, Owner: &#34;Brad&#34;},
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        array<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CAR11&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        array<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Ford&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        array<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Mustang&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        array<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;gray&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        array<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Zeal&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;arguments&#34;</span><span style="color:#f92672">,</span> array<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;user001&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        object<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;organization&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;org1&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        String url <span style="color:#f92672">=</span> uri <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/updateByChaincode?appId=&#34;</span> <span style="color:#f92672">+</span> appId <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;appSecret=&#34;</span> <span style="color:#f92672">+</span> appSecret<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        String requestBody <span style="color:#f92672">=</span> object<span style="color:#f92672">.</span><span style="color:#a6e22e">toJSONString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        Result<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> httpResult <span style="color:#f92672">=</span> HttpUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">post</span><span style="color:#f92672">(</span>url<span style="color:#f92672">,</span> requestBody<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>httpResult<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        FabricRestTest test <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FabricRestTest<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//        test.testAppProfile();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//        test.testListAffiliation();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">//It&#39;s already called by start.sh, but we invoke it again
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//        test.testInitLedger();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        test<span style="color:#f92672">.</span><span style="color:#a6e22e">createCar</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//Result:[resultCode=200, resultMessage=null,resultEntity={&#34;resultCode&#34;:0,&#34;resultEntity&#34;:[{&#34;Record&#34;:{&#34;owner&#34;:&#34;Tomoko&#34;,&#34;colour&#34;:&#34;blue&#34;,&#34;model&#34;:&#34;Prius&#34;,&#34;make&#34;:&#34;Toyota&#34;},&#34;Key&#34;:&#34;CAR0&#34;},{&#34;Record&#34;:{&#34;owner&#34;:&#34;Brad&#34;,&#34;colour&#34;:&#34;red&#34;,&#34;model&#34;:&#34;Mustang&#34;,&#34;make&#34;:&#34;Ford&#34;},&#34;Key&#34;:&#34;CAR1&#34;},{&#34;Record&#34;:{&#34;owner&#34;:&#34;Zeal&#34;,&#34;colour&#34;:&#34;gray&#34;,&#34;model&#34;:&#34;Mustang&#34;,&#34;make&#34;:&#34;Ford&#34;},&#34;Key&#34;:&#34;CAR11&#34;},{&#34;Record&#34;:{&#34;owner&#34;:&#34;Jin Soo&#34;,&#34;colour&#34;:&#34;green&#34;,&#34;model&#34;:&#34;Tucson&#34;,&#34;make&#34;:&#34;Hyundai&#34;},&#34;Key&#34;:&#34;CAR2&#34;},{&#34;Record&#34;:{&#34;owner&#34;:&#34;Max&#34;,&#34;colour&#34;:&#34;yellow&#34;,&#34;model&#34;:&#34;Passat&#34;,&#34;make&#34;:&#34;Volkswagen&#34;},&#34;Key&#34;:&#34;CAR3&#34;},{&#34;Record&#34;:{&#34;owner&#34;:&#34;Adriana&#34;,&#34;colour&#34;:&#34;black&#34;,&#34;model&#34;:&#34;S&#34;,&#34;make&#34;:&#34;Tesla&#34;},&#34;Key&#34;:&#34;CAR4&#34;},{&#34;Record&#34;:{&#34;owner&#34;:&#34;Michel&#34;,&#34;colour&#34;:&#34;purple&#34;,&#34;model&#34;:&#34;205&#34;,&#34;make&#34;:&#34;Peugeot&#34;},&#34;Key&#34;:&#34;CAR5&#34;},{&#34;Record&#34;:{&#34;owner&#34;:&#34;Aarav&#34;,&#34;colour&#34;:&#34;white&#34;,&#34;model&#34;:&#34;S22L&#34;,&#34;make&#34;:&#34;Chery&#34;},&#34;Key&#34;:&#34;CAR6&#34;},{&#34;Record&#34;:{&#34;owner&#34;:&#34;Pari&#34;,&#34;colour&#34;:&#34;violet&#34;,&#34;model&#34;:&#34;Punto&#34;,&#34;make&#34;:&#34;Fiat&#34;},&#34;Key&#34;:&#34;CAR7&#34;},{&#34;Record&#34;:{&#34;owner&#34;:&#34;Valeria&#34;,&#34;colour&#34;:&#34;indigo&#34;,&#34;model&#34;:&#34;Nano&#34;,&#34;make&#34;:&#34;Tata&#34;},&#34;Key&#34;:&#34;CAR8&#34;},{&#34;Record&#34;:{&#34;owner&#34;:&#34;Shotaro&#34;,&#34;colour&#34;:&#34;brown&#34;,&#34;model&#34;:&#34;Barina&#34;,&#34;make&#34;:&#34;Holden&#34;},&#34;Key&#34;:&#34;CAR9&#34;}],&#34;resultMessage&#34;:&#34;&#34;}]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        test<span style="color:#f92672">.</span><span style="color:#a6e22e">queryAllCars</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//FIXME Change owner
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="开发计划">开发计划</h3>
<p>完整的发布应该类似Tomcat一样的默认打包, 控制脚本等, 消息通知的版本有差异, 对官方Java SDK一些细节也有一些疑惑, 先陆续稳定一版。原则上Fabric REST只做到简单够用即可(毕竟代理了一层,HTTP和无状态也有些限制), 毕竟GRPC现在连JS SDK都有, 其它语言的SDK是时间问题.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://www.51discuss.com/">Zealot</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://www.51discuss.com/posts/luoying-server-opensource/">https://www.51discuss.com/posts/luoying-server-opensource/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/fabric-1.4rc-release/">Hyperledger Fabric 1.4新特性</a></li>
        
        <li><a href="/posts/2018-blockchain-conference-doc/">2018中国区块链技术大会PPT</a></li>
        
        <li><a href="/posts/2018-blockchain-conference/">2018中国区块链技术大会收获</a></li>
        
        <li><a href="/posts/fabric-couchdb-upgrade-issue/">Hyperledger Fabric升级couchdb镜像版本的问题</a></li>
        
        <li><a href="/posts/fabric-msp-advanced/">Hyperledger Fabric权限进阶篇</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/fabric'>fabric</a></li>
                
                <li><a href='/tags/java'>java</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    
    

</div>

                    <footer id="footer">
    <div>
        &copy; 2022 <a href="https://www.51discuss.com/">谈前沿技术 By Zealot</a>
        
        | <a rel="nofollow" target="_blank" href="https://beian.miit.gov.cn/">粤ICP备19118912号</a>
        
    </div>
    <br />
    
</footer>


    
    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action="https://www.baidu.com/s" method="get" accept-charset="utf-8" target="_blank">
      
      <input type="hidden" name="q1">
      <input type="hidden" name="q2">
      <input type="text" name="q3" maxlength="32" placeholder="站内搜索">
      <input type="hidden" name="gpc" value="stf">
      <input type="hidden" name="q4">
      <input type="hidden" name="q6" value="https://www.51discuss.com">
      <input type="hidden" name="tn" value="baiduadv">
      <button type="submit" class="submit icon-search"></button>
</form>
<img src="/images/hyperledger_fabric_qrcode.jpg" />
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://www.51discuss.com/posts/paddle-ocr-guideline/" title="机器视觉基础之PaddleOCR入门">机器视觉基础之PaddleOCR入门</a>
    </li>
    
    <li>
        <a href="https://www.51discuss.com/posts/20210114-middleground-not-silver-bullet/" title="中台 != 银弹">中台 != 银弹</a>
    </li>
    
    <li>
        <a href="https://www.51discuss.com/posts/harmony2.0-discussion/" title="华为鸿蒙HarmonyOS的红与黑">华为鸿蒙HarmonyOS的红与黑</a>
    </li>
    
    <li>
        <a href="https://www.51discuss.com/posts/finacial-app-of-bc-tech-evalution-rules/" title="中国金融行业标准JR/T 0193—2020 区块链技术金融应用评估规则">中国金融行业标准JR/T 0193—2020 区块链技术金融应用评估规则</a>
    </li>
    
    <li>
        <a href="https://www.51discuss.com/posts/bsn-white-paper/" title="区块链服务网络基础白皮书">区块链服务网络基础白皮书</a>
    </li>
    
    <li>
        <a href="https://www.51discuss.com/posts/micro-service-selection/" title="全栈式微服务解决方案的选型">全栈式微服务解决方案的选型</a>
    </li>
    
    <li>
        <a href="https://www.51discuss.com/posts/fabtoken-removed/" title="为什么Fabtoken在fabric 2.0被删除">为什么Fabtoken在fabric 2.0被删除</a>
    </li>
    
    <li>
        <a href="https://www.51discuss.com/posts/fabric-2.0-installation/" title="折腾的Fabric 2.0安装">折腾的Fabric 2.0安装</a>
    </li>
    
    <li>
        <a href="https://www.51discuss.com/posts/fabric-2.0-release/" title="Hyperledger Fabric 2.0正式版发布">Hyperledger Fabric 2.0正式版发布</a>
    </li>
    
    <li>
        <a href="https://www.51discuss.com/posts/fiscobcos-key-concept/" title="(转载)FISCOBCOS关键概念">(转载)FISCOBCOS关键概念</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://www.51discuss.com/categories/os/">OS (1)</a></li>
    
    <li><a href="https://www.51discuss.com/categories/%E4%B8%AD%E5%8F%B0/">中台 (1)</a></li>
    
    <li><a href="https://www.51discuss.com/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链 (45)</a></li>
    
    <li><a href="https://www.51discuss.com/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统 (1)</a></li>
    
    <li><a href="https://www.51discuss.com/categories/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/">机器视觉 (1)</a></li>
    
    <li><a href="https://www.51discuss.com/categories/%E6%B8%B8%E6%88%8F/">游戏 (1)</a></li>
    
    <li><a href="https://www.51discuss.com/categories/%E7%89%A9%E8%81%94%E7%BD%91/">物联网 (1)</a></li>
    
    <li><a href="https://www.51discuss.com/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言 (8)</a></li>
    
    <li><a href="https://www.51discuss.com/categories/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">解决方案 (5)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://www.51discuss.com/tags/android/">android</a>
    
    <a href="https://www.51discuss.com/tags/couchdb/">couchdb</a>
    
    <a href="https://www.51discuss.com/tags/diablo/">diablo</a>
    
    <a href="https://www.51discuss.com/tags/fabric/">fabric</a>
    
    <a href="https://www.51discuss.com/tags/fiscobcos/">fiscobcos</a>
    
    <a href="https://www.51discuss.com/tags/go/">go</a>
    
    <a href="https://www.51discuss.com/tags/harmonyos/">HarmonyOS</a>
    
    <a href="https://www.51discuss.com/tags/hyperledger/">hyperledger</a>
    
    <a href="https://www.51discuss.com/tags/ipfs/">ipfs</a>
    
    <a href="https://www.51discuss.com/tags/java/">java</a>
    
    <a href="https://www.51discuss.com/tags/kafka/">kafka</a>
    
    <a href="https://www.51discuss.com/tags/libra/">libra</a>
    
    <a href="https://www.51discuss.com/tags/ocr/">ocr</a>
    
    <a href="https://www.51discuss.com/tags/rpc/">rpc</a>
    
    <a href="https://www.51discuss.com/tags/spring/">spring</a>
    
    <a href="https://www.51discuss.com/tags/%E4%B8%9A%E5%8A%A1%E4%B8%AD%E5%8F%B0/">业务中台</a>
    
    <a href="https://www.51discuss.com/tags/%E4%BA%91%E5%B9%B3%E5%8F%B0/">云平台</a>
    
    <a href="https://www.51discuss.com/tags/%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E5%8C%96/">企业信息化</a>
    
    <a href="https://www.51discuss.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a>
    
    <a href="https://www.51discuss.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a>
    
    <a href="https://www.51discuss.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%AD%E5%8F%B0/">微服务,架构设计,中台</a>
    
    <a href="https://www.51discuss.com/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/">架构设计</a>
    
    <a href="https://www.51discuss.com/tags/%E7%BC%96%E8%AF%91%E5%99%A8/">编译器</a>
    
    <a href="https://www.51discuss.com/tags/%E8%BD%A6%E8%81%94%E7%BD%91/">车联网</a>
    
    <a href="https://www.51discuss.com/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/">高并发</a>
    
    <a href="https://www.51discuss.com/tags/%E9%B8%BF%E8%92%99/">鸿蒙</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://www.51discuss.com/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>